<!DOCTYPE html>
<html
    xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
    <head>
        <meta charset="UTF-8" />
        <title>Cart</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
    </head>

    <body class="p-4">
        <div class="container">
            <h1>Your Cart</h1>

            <div th:if="${items.size() == 0}">
                <div class="alert alert-info">
                    Your cart is empty.
                    <a th:href="@{/products}">Continue shopping</a>
                </div>
            </div>

            <div th:if="${items.size() > 0}">
                <form th:action="@{/cart/update}" method="post">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Price</th>
                                <th style="width: 120px">Quantity</th>
                                <th>Subtotal</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="it : ${items}">
                                <td th:text="${it.product.name}">Name</td>
                                <td th:text="${it.product.price}">0.0</td>
                                <td>
                                    <input
                                        type="number"
                                        min="0"
                                        th:name="${'quantity_' + it.product.id}"
                                        th:value="${it.quantity}"
                                        class="form-control"
                                    />
                                </td>
                                <td th:text="${it.subtotal}">0.0</td>
                                <td>
                                    <form
                                        th:action="@{|/cart/remove/${it.product.id}|}"
                                        method="post"
                                        style="display: inline"
                                    >
                                        <button class="btn btn-sm btn-danger">
                                            Remove
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div
                        class="d-flex justify-content-between align-items-center"
                    >
                        <div>
                            <button
                                type="submit"
                                class="btn btn-primary"
                                sec:authorize="hasAnyRole('CUSTOMER','ADMIN')"
                            >
                                Update Cart
                            </button>
                            <form
                                th:action="@{/cart/clear}"
                                method="post"
                                style="display: inline"
                                sec:authorize="hasAnyRole('CUSTOMER','ADMIN')"
                            >
                                <button class="btn btn-outline-secondary ms-2">
                                    Clear Cart
                                </button>
                            </form>
                        </div>
                        <div>
                            <strong>Total: </strong>
                            <span th:text="${total}">0.0</span>
                            <a
                                th:href="@{/cart/checkout}"
                                class="btn btn-success ms-3"
                                sec:authorize="hasAnyRole('CUSTOMER','ADMIN')"
                                >Checkout</a
                            >
                            <a
                                th:href="@{/login}"
                                class="btn btn-success ms-3"
                                sec:authorize="isAnonymous()"
                                >Login to Checkout</a
                            >
                        </div>
                    </div>
                </form>
            </div>

            <div class="mt-3">
                <a th:href="@{/products}" class="btn btn-secondary"
                    >Continue Shopping</a
                >
            </div>
        </div>
    </body>
</html>
