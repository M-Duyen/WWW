<!DOCTYPE html>
<html
    xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
    <head>
        <meta charset="UTF-8" />
        <title>Orders</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
    </head>

    <body class="p-4">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h1>Orders</h1>
                <div>
                    <form th:action="@{/orders}" method="get" class="d-flex">
                        <input
                            type="text"
                            name="customerName"
                            th:value="${customerName}"
                            class="form-control me-2"
                            placeholder="Search customer..."
                        />
                        <input
                            type="text"
                            name="productName"
                            th:value="${productName}"
                            class="form-control me-2"
                            placeholder="Search product..."
                        />
                        <button class="btn btn-outline-secondary" type="submit">
                            Search
                        </button>
                    </form>
                </div>
            </div>

            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Customer</th>
                        <th>Date</th>
                        <th>Total</th>
                        <th>Products</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="o : ${orders}">
                        <td th:text="${o.id}">1</td>
                        <td
                            th:text="${o.customer != null ? o.customer.name : '--'}"
                        >
                            Customer
                        </td>
                        <td th:text="${o.date}">2025-10-11</td>
                        <td th:text="${o.total}">0.0</td>
                        <td>
                            <ul>
                                <li
                                    th:each="ol : ${o.orderLineSet}"
                                    th:text="${ol.product.name + ' x' + ol.quantity}"
                                >
                                    Product
                                </li>
                            </ul>
                        </td>
                        <td>
                            <a
                                th:href="@{|/orders/${o.id}|}"
                                class="btn btn-sm btn-info"
                                >View</a
                            >
                            <a
                                th:href="@{|/orders/edit/${o.id}|}"
                                class="btn btn-sm btn-warning"
                                sec:authorize="hasRole('ADMIN')"
                                >Edit</a
                            >
                            <form
                                th:action="@{|/orders/delete/${o.id}|}"
                                method="post"
                                style="display: inline"
                                sec:authorize="hasRole('ADMIN')"
                            >
                                <button
                                    type="submit"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Delete?')"
                                >
                                    Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </body>
</html>
