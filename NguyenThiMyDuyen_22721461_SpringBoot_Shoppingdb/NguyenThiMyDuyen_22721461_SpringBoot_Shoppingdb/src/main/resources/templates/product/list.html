<!DOCTYPE html>
<html
    xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
    <head>
        <meta charset="UTF-8" />
        <title>Products</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
    </head>

    <body class="p-4">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h1>Products</h1>
                <div>
                    <form
                        th:action="@{/products}"
                        method="get"
                        class="d-inline-block me-2"
                    >
                        <div class="input-group">
                            <input
                                type="text"
                                name="q"
                                th:value="${q}"
                                class="form-control"
                                placeholder="Search products..."
                            />
                            <button
                                class="btn btn-outline-secondary"
                                type="submit"
                            >
                                Search
                            </button>
                        </div>
                    </form>
                    <a
                        th:href="@{/products/create}"
                        class="btn btn-success me-2"
                        sec:authorize="hasRole('ADMIN')"
                        >Add Product</a
                    >
                    <a
                        th:href="@{/cart}"
                        class="btn btn-outline-primary"
                        sec:authorize="isAuthenticated()"
                        >View Cart</a
                    >
                    <a
                        th:href="@{/login}"
                        class="btn btn-outline-primary"
                        sec:authorize="isAnonymous()"
                        >Login</a
                    >
                </div>
            </div>

            <div class="row row-cols-1 row-cols-md-3 g-4">
                <div class="col" th:each="product : ${products}">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title" th:text="${product.name}">
                                Product Name
                            </h5>
                            <p class="card-text mb-1">
                                <strong>Price:</strong>
                                <span th:text="${product.price}">0.0</span>
                            </p>
                            <p class="card-text mb-2">
                                <strong>In Stock:</strong>
                                <span th:text="${product.inStock}">0</span>
                            </p>
                            <p
                                class="card-text text-muted mb-3"
                                th:text="${product.category != null ? product.category.name : ''}"
                            >
                                Category
                            </p>

                            <form
                                th:action="@{/cart/add}"
                                method="post"
                                class="mt-auto"
                                sec:authorize="hasAnyRole('CUSTOMER','ADMIN')"
                            >
                                <input
                                    type="hidden"
                                    name="productId"
                                    th:value="${product.id}"
                                />
                                <div
                                    class="input-group mb-2"
                                    style="max-width: 140px"
                                >
                                    <input
                                        type="number"
                                        name="quantity"
                                        min="1"
                                        value="1"
                                        class="form-control"
                                    />
                                    <button
                                        type="submit"
                                        class="btn btn-primary"
                                    >
                                        Add
                                    </button>
                                </div>
                            </form>

                            <div class="mt-auto" sec:authorize="isAnonymous()">
                                <a th:href="@{/login}" class="btn btn-primary"
                                    >Login to add</a
                                >
                            </div>

                            <div class="mt-2">
                                <a
                                    th:href="@{|/products/${product.id}|}"
                                    class="btn btn-link p-0"
                                    >View Detail</a
                                >
                                <a
                                    th:href="@{|/products/edit/${product.id}|}"
                                    class="btn btn-link p-0 ms-3"
                                    sec:authorize="hasRole('ADMIN')"
                                    >Edit</a
                                >
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
